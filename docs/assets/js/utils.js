import{openDB}from'https://cdn.jsdelivr.net/npm/idb@7/build/index.js';const DB_NAME='GraphDataDB';const STORE_NAME='GraphStore';const DATA_KEY='fullGraph';async function initDB(){return openDB(DB_NAME,1,{upgrade(db){db.createObjectStore(STORE_NAME);},});}
export async function fetchGraphData(){const db=await initDB();let cachedData=await db.get(STORE_NAME,DATA_KEY);if(cachedData){if(new Date(cachedData.cacheExpires)>Date.now()){console.log("Dados carregados do cache!");return cachedData;}else{console.log("Cache expirado. Limpando dados locais...");db.delete(STORE_NAME,DATA_KEY);}}
    try{const response=await fetch('./assets/data/grafo_salvo.json');if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}
        const networkData=await response.json();const networkDataSorted={nodes:networkData.nodes.sort((a,b)=>{if(a.depth!==b.depth){return a.depth-b.depth;}
                return a.elapsedTime-b.elapsedTime;}),links:networkData.links,generatedAt:networkData.generatedAt,cacheExpires:networkData.generatedAt+(1000*60*60*24)>Date.now()?networkData.generatedAt+(1000*60*60*24):Date.now()+(1000*60*60*24),};console.log("Salvando dados da rede no cache...");await db.put(STORE_NAME,networkDataSorted,DATA_KEY);return networkDataSorted;}catch(error){console.error("Erro ao carregar o arquivo grafo_salvo.json:",error);throw error;}}
export function findPath(startId,endId,graph){if(!startId||!endId||!graph)return null;const adj=new Map();graph.links.forEach(link=>{if(!adj.has(link.source))adj.set(link.source,[]);adj.get(link.source).push(link.target);});const queue=[startId];const visited=new Set([startId]);const predecessor=new Map();while(queue.length>0){const currentNodeId=queue.shift();if(currentNodeId===endId){const path=[];let step=endId;while(step){path.push(step);step=predecessor.get(step);}
    return path.reverse();}
    const neighbors=adj.get(currentNodeId)||[];for(const neighborId of neighbors){if(!visited.has(neighborId)){visited.add(neighborId);predecessor.set(neighborId,currentNodeId);queue.push(neighborId);}}}
    return null;}